<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>MCAgent</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <link rel="stylesheet" href="css/modules/01-theme.css">
    <link rel="stylesheet" href="css/modules/02-layout.css">
    <link rel="stylesheet" href="css/modules/03-panel-left-list.css">
    <link rel="stylesheet" href="css/modules/04-panel-center-chat.css">
    <link rel="stylesheet" href="css/modules/05a-panel-right-layout.css">
    <link rel="stylesheet" href="css/modules/05b-tab-documents.css">
    <link rel="stylesheet" href="css/modules/05c-tab-lenders.css">
    <link rel="stylesheet" href="css/modules/05e-tab-notes.css">
    <link rel="stylesheet" href="css/modules/06a-submission-modal.css">
    <link rel="stylesheet" href="css/modules/05d-tab-ai.css">
    <link rel="stylesheet" href="css/modules/06-components-modals.css">
    <link rel="stylesheet" href="css/modules/08-components-buttons.css">
    <link rel="stylesheet" href="css/modules/07-utilities.css">
    <link rel="stylesheet" href="css/modules/deal-intelligence.css">
    <link rel="stylesheet" href="css/modules/09-power-dialer.css">
    <link rel="stylesheet" href="css/modules/10-lender-admin.css">
    <link rel="stylesheet" href="css/user-menu.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <div class="command-center">
        <div class="main-content">
            <div class="left-panel">
                <div class="panel-header">
                    <div class="unified-toolbar">
                        <div class="filter-wrapper">
                            <select class="state-filter-icon" id="stateFilter" title="Filter Status">
                                <option value="">All Leads</option>
                                <option value="ACTIVE">Active</option>
                                <option value="QUALIFIED">Qualified</option>
                                <option value="PITCHED">Pitched</option>
                                <option value="SUBMITTED">Submitted</option>
                                <option value="OFFER">Offer</option>
                                <option value="DEAD">Dead</option>
                            </select>
                            <i class="fas fa-filter filter-icon-indicator"></i>
                        </div>

                        <input type="text" class="search-field-clean" id="searchInput" placeholder="Search...">

                        <div class="action-group">
                            <button class="tool-btn primary" data-action="open-rich-create" title="New Conversation">
                                <i class="fas fa-plus"></i>
                            </button>

                            <button class="tool-btn" data-action="open-csv-import" title="Import">
                                <i class="fas fa-file-import"></i>
                            </button>

                            <button class="tool-btn danger-hover" id="toggleDeleteModeBtn" data-action="toggle-delete-mode" title="Delete">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>

                    <button id="deleteSelectedBtn" class="btn btn-danger full-width hidden delete-selection-trigger">
                        Delete Selected
                    </button>
                </div>
                <div class="conversations-list" id="conversationsList">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Loading conversations...</p>
                    </div>
                </div>
            </div>

            <div class="center-panel">
                <div id="dashboardView" class="view-layer">
                    <div class="dashboard-container">

                        <!-- Hero Welcome Card -->
                        <div class="hero-card">
                            <h1 class="hero-greeting" id="heroGreeting" style="visibility: hidden;"></h1>
                            <p class="hero-quote" id="heroQuote">"Success is not final, failure is not fatal: it is the courage to continue that counts."</p>
                            <div class="hero-date" id="heroDate">Tuesday, December 23, 2025</div>
                        </div>

                        <!-- Stats Row -->
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-fire"></i></div>
                                <div class="stat-value" id="activeCount">-</div>
                                <div class="stat-label">Active</div>
                            </div>
                            <div class="stat-card" style="cursor: pointer;" data-action="show-submitted">
                                <div class="stat-icon"><i class="fas fa-paper-plane"></i></div>
                                <div class="stat-value" id="submittedCount">-</div>
                                <div class="stat-label">Submitted</div>
                            </div>
                            <div class="stat-card" style="cursor: pointer;" data-action="show-offers">
                                <div class="stat-icon" style="color: #10b981;"><i class="fas fa-dollar-sign"></i></div>
                                <div class="stat-value" id="offersCount">-</div>
                                <div class="stat-label">Offers</div>
                            </div>
                        </div>

                        <!-- Monthly Funding Goal -->
                        <div class="goal-card" id="fundingGoalCard" data-action="edit-goal" style="cursor: pointer;" title="Click to edit goal">
                            <div class="goal-header">
                                <div>
                                    <div class="goal-title">Monthly Funding Goal</div>
                                    <div class="goal-numbers">
                                        <span id="fundedAmount">$0</span>
                                        <span class="goal-subtext">/ <span id="goalAmount">$500,000</span></span>
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div id="goalPercentage" style="font-size: 28px; font-weight: 700; color: #10b981;">0%</div>
                                    <div style="font-size: 12px; color: #8b949e;"><span id="dealsCount">0</span> deals closed</div>
                                </div>
                            </div>
                            <div class="progress-track">
                                <div class="progress-fill" id="goalProgressBar" style="width: 0%;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 12px; font-size: 12px; color: #6e7681;">
                                <span>Last month: <span id="lastMonthAmount" style="color: #8b949e;">$0</span></span>
                                <span id="goalStatus" style="color: #10b981;">On track</span>
                            </div>
                        </div>

                        <!-- Quick Actions Row -->
                        <div class="quick-actions-grid">
                            <div class="action-card" data-action="open-dialer">
                                <div class="action-icon"><i class="fas fa-phone-volume"></i></div>
                                <div class="action-label">Dialer</div>
                            </div>
                            <div class="action-card" data-action="open-formatter">
                                <div class="action-icon"><i class="fas fa-table"></i></div>
                                <div class="action-label">Formatter</div>
                            </div>
                            <div class="action-card" data-action="open-lender-management">
                                <div class="action-icon"><i class="fas fa-university"></i></div>
                                <div class="action-label">Lenders</div>
                            </div>
                            <div class="action-card" data-action="open-verifier">
                                <div class="action-icon"><i class="fas fa-user-check"></i></div>
                                <div class="action-label">Verify</div>
                            </div>
                            <div class="action-card" data-action="open-settings">
                                <div class="action-icon"><i class="fas fa-cog"></i></div>
                                <div class="action-label">Settings</div>
                            </div>
                        </div>

                    </div>
                </div>

                <div id="chatView" class="view-layer hidden">
                    <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center; padding: 0 15px;">
                        <div id="conversationHeaderContent" class="header-info" style="flex: 1;">
                            <h3 id="currentContactName" style="margin: 0;">Select a Conversation</h3>
                        </div>

                        <div class="header-actions">
                            <button id="addToDialerBtn" class="tool-btn" title="Add to Dialer">
                                <i class="fas fa-phone"></i>
                            </button>
                            <button id="aiToggleBtn" class="ai-toggle-btn">
                                <i class="fas fa-robot"></i>
                                <span id="aiBtnText">Loading...</span>
                            </button>
                        </div>
                    </div>

                    <div class="messages-container" id="messagesContainer">
                        </div>

                    <div class="message-input-container" id="messageInputContainer">
                        <div class="ai-suggestions hidden" id="aiSuggestions">
                            <div class="suggestions-header">
                                <span>AI Suggestions:</span>
                                <button class="close-suggestions" id="closeSuggestions">√ó</button>
                            </div>
                            <div class="suggestions-list" id="suggestionsList"></div>
                        </div>
                        <div class="input-deck-main">
                            <input type="file" id="fileInput" accept="image/*" class="hidden">
                            <button class="attachment-icon" id="attachmentBtn" title="Attach file">üìé</button>
                            <textarea class="message-input" id="messageInput" placeholder="Message" rows="1"></textarea>
                            <button class="icon-btn-small primary-send" id="sendMessageBtn" title="Send">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>

                        <!-- SMART DIALER VIEW -->
                <div id="dialerView" class="view-layer hidden">
                    <div class="dialer-container">

                        <!-- Header Bar -->
                        <div class="dialer-header">
                            <div class="dialer-header-left">
                                <button class="dialer-back-btn" id="dialerBackBtn" title="Back to Dashboard">
                                    <i class="fas fa-arrow-left"></i>
                                </button>
                                <i class="fas fa-phone-volume"></i>
                                <span class="dialer-title">Smart Dialer</span>
                            </div>
                            <div class="dialer-header-right">
                                <span class="dialer-queue-count">Queue: <strong id="dialerQueueCount">0</strong> leads</span>
                            </div>
                        </div>

                        <!-- Main Calling Card -->
                        <div class="dialer-calling-card" id="dialerCallingCard">

                            <!-- Queue Preview State (Default) -->
                            <div class="dialer-state" id="dialerIdleState">
                                <div class="queue-preview-header">
                                    <h2>Ready to Dial</h2>
                                    <p class="dialer-subtitle">Review and uncheck any leads you want to skip</p>
                                    <div class="queue-select-actions">
                                        <button class="queue-action-btn" id="queueSelectAll">Select All</button>
                                        <button class="queue-action-btn" id="queueDeselectAll">Deselect All</button>
                                    </div>
                                </div>

                                <div class="queue-preview-list" id="queuePreviewList">
                                    <div class="queue-loading">
                                        <div class="loading-spinner small"></div>
                                        <span>Loading queue...</span>
                                    </div>
                                </div>

                                <div class="queue-preview-footer">
                                    <span class="queue-selected-count"><strong id="selectedQueueCount">0</strong> leads selected</span>
                                    <button class="dialer-start-btn" id="dialerStartBtn">
                                        <i class="fas fa-play"></i> Start Dialing
                                    </button>
                                </div>
                            </div>

                            <!-- Active Call State -->
                            <div class="dialer-state hidden" id="dialerActiveState">
                                <div class="dialer-status-badge" id="dialerStatusBadge">
                                    <span class="status-dot"></span>
                                    <span id="dialerStatusText">CONNECTING...</span>
                                </div>

                                <div class="dialer-lead-info">
                                    <h2 id="dialerLeadName">John Smith</h2>
                                    <p class="dialer-business" id="dialerBusinessName">ABC Transport LLC</p>
                                    <p class="dialer-phone" id="dialerPhone">(813) 431-1601</p>
                                </div>

                                <div class="dialer-timer" id="dialerTimer">00:00</div>

                                <div class="dialer-attempt-info">
                                    Attempt <span id="dialerAttemptNum">1</span> of 2
                                </div>

                                <button class="dialer-end-call-btn" id="dialerEndCallBtn">
                                    <i class="fas fa-phone-slash"></i> End Call
                                </button>
                            </div>

                        </div>

                        <!-- Disposition Buttons -->
                        <div class="dialer-disposition hidden" id="dialerDisposition">
                            <div class="disposition-label">Log this call:</div>
                            <div class="disposition-grid">
                                <button class="disposition-btn" data-disposition="answered">
                                    <i class="fas fa-phone"></i>
                                    <span>Answered</span>
                                </button>
                                <button class="disposition-btn" data-disposition="no_answer">
                                    <i class="fas fa-phone-slash"></i>
                                    <span>No Answer</span>
                                </button>
                                <button class="disposition-btn" data-disposition="voicemail">
                                    <i class="fas fa-voicemail"></i>
                                    <span>Voicemail</span>
                                </button>
                                <button class="disposition-btn" data-disposition="not_interested">
                                    <i class="fas fa-ban"></i>
                                    <span>Not Interested</span>
                                </button>
                                <button class="disposition-btn" data-disposition="wrong_number">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <span>Wrong #</span>
                                </button>
                                <button class="disposition-btn disposition-convo" id="dialerConvoBtn">
                                    <i class="fas fa-comment-dots"></i>
                                    <span>View Convo</span>
                                </button>
                            </div>
                        </div>

                        <!-- Footer -->
                        <div class="dialer-footer hidden" id="dialerFooter">
                            <div class="dialer-footer-left">
                                <button class="dialer-stop-btn" id="dialerStopBtn">
                                    <i class="fas fa-stop"></i> Stop Dialer
                                </button>
                            </div>
                            <div class="dialer-footer-right">
                                <button class="dialer-skip-btn" id="dialerSkipBtn">
                                    <i class="fas fa-forward"></i> Skip
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="right-panel">

                <div id="rightPanelHome" class="right-panel-state">
                    <div class="news-feed" id="newsFeedContainer"></div>
                </div>

                <div id="rightPanelIntelligence" class="right-panel-state hidden">
                    <div class="panel-header">
                        <div class="intelligence-tabs" id="intelligenceTabs">
                            <button class="tab-btn active" data-tab="ai-assistant">AI Agent</button>
                            <button class="tab-btn" data-tab="documents">Docs</button>
                            <button class="tab-btn" data-tab="edit">Edit</button>
                            <button class="tab-btn" data-tab="fcs">FCS</button>
                            <button class="tab-btn" data-tab="strategy">Strategy</button>
                            <button class="tab-btn" data-tab="lenders">Submission</button>
                            <button class="tab-btn" data-tab="notes">
                                Notes
                                <span id="notesTabBadge" class="tab-badge" style="display: none;">0</span>
                            </button>
                        </div>
                    </div>
                    <div class="intelligence-content" id="intelligenceContent">
                        <div class="empty-state">
                            <div class="loading-spinner small"></div>
                            <p>Loading lead data...</p>
                        </div>

                        <div id="lenderForm" class="hidden"></div>
                        <div id="lenderResults" class="hidden"></div>
                        <div id="lenderLoading" class="hidden"></div>
                        <div id="lenderErrorMsg" class="hidden"></div>
                        <div id="lendersTableContainer" class="hidden"></div>

                        <div id="fcsDocumentSelection" class="hidden"></div>
                        <div id="fcsResults" class="hidden"></div>
                        <div id="fcsLoading" class="hidden"></div>
                        <div id="fcsErrorMsg" class="hidden"></div>

                        <div id="strategyResults" class="hidden"></div>
                    </div>

                    <div id="notesPanel" class="intelligence-content hidden">
                        <div class="notes-tab-container">
                            <div id="notesList" class="notes-list">
                                <div class="notes-empty">
                                    <i class="far fa-sticky-note"></i>
                                    <p>No notes yet.</p>
                                </div>
                            </div>
                            <div class="notes-input-wrapper">
                                <textarea id="notesInput" class="notes-textarea" placeholder="Type a note... (Enter to send)" rows="1"></textarea>
                                <button id="notesSendBtn" class="btn-send-note" title="Save Note">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="status-bar">
            <div class="status-left">
                <span id="lastUpdated">Last updated: Never</span>
            </div>
            <div class="status-center">
                <div class="processing-indicator hidden" id="processingIndicator">
                    <div class="loading-spinner small"></div>
                    <span id="processingText">Processing...</span>
                </div>
            </div>
            <div class="status-right">
                <span id="systemStatus">System: Ready</span>
            </div>
        </div>
    </div>

    <!-- Background Verification Modal -->
    <div id="cleanerModal" class="modal-overlay">
        <div class="modal-box">
            <h3 class="modal-title"><i class="fas fa-user-check"></i> Background Verification</h3>
            <p class="modal-description">Upload a CSV to enrich with verified mobile numbers and home addresses.</p>

            <input type="file" id="cleanerFileInput" class="file-input" accept=".csv">

            <div id="cleanerProgress" class="progress-container hidden">
                <div class="progress-bar-track">
                    <div id="cleanerProgressBar" class="progress-bar-fill"></div>
                </div>
                <p id="cleanerStatus" class="progress-status">Verifying records...</p>
            </div>

            <div class="modal-actions">
                <button onclick="runCleaner()" class="btn btn-primary">
                    <i class="fas fa-play"></i> Verify File
                </button>
                <button onclick="closeCleanerModal()" class="btn btn-secondary">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <div class="modal hidden" id="csvImportModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>üìä Import Conversations from CSV</h3>
                <button class="modal-close" id="closeCsvImportModal">√ó</button>
            </div>
            <div class="modal-body modal-body-scroll">
                <div id="csvUploadSection" class="csv-section">
                    <div class="upload-drop-zone" id="csvUploadArea">
                        <div class="upload-icon">üìÑ</div>
                        <h4 class="upload-title">Drag and drop your CSV file here</h4>
                        <p class="upload-subtitle">Or click to select a file</p>
                        <input type="file" class="hidden" id="csvFileInput" accept=".csv" />
                        <button class="btn btn-primary" id="csvSelectFileBtn">Select File</button>
                    </div>
                    <div class="csv-file-info hidden" id="csvFileInfo">
                        <h4 class="info-header">File Information</h4>
                        <div id="csvFileDetails"></div>
                    </div>
                </div>

                <div id="csvMappingSection" class="csv-section hidden">
                    <div id="csvMappingControls"></div>
                    <div class="modal-actions-row">
                         <button class="btn btn-secondary" id="csvBackToUploadBtn">Back</button>
                         <button class="btn btn-primary" id="csvValidateMappingBtn">Validate</button>
                    </div>
                </div>

                 <div id="csvValidationSection" class="csv-section hidden">
                    <div id="csvValidationResults"></div>
                    <div class="modal-actions-row">
                        <button class="btn btn-secondary" id="csvBackToMappingBtn">Back</button>
                        <button class="btn btn-primary" id="csvProceedToImportBtn">Import</button>
                    </div>
                </div>

                <div id="csvImportSection" class="csv-section hidden">
                    <h4 style="text-align:center; color:#e6edf3; margin-bottom:10px;">Importing Data...</h4>

                    <div class="progress-track-bg">
                        <div id="csvProgressFill" style="width: 0%"></div>
                    </div>

                    <div id="csvImportStatus">Preparing...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal hidden" id="deleteConfirmModal">
        <div class="modal-content small-modal">
            <div class="modal-header">
                <h3>‚ö†Ô∏è Delete Lead</h3>
                <button class="modal-close" id="closeDeleteConfirmModal">√ó</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to <strong>permanently delete</strong> this lead?</p>
                <div class="lead-info" id="deleteLeadInfo">
                    <strong>Lead:</strong> <span id="deleteLeadName">Loading...</span><br>
                    <strong>Phone:</strong> <span id="deleteLeadPhone">Loading...</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDelete">Cancel</button>
                <button class="btn btn-danger" id="confirmDelete">Delete Lead</button>
            </div>
        </div>
    </div>

    <div class="modal hidden" id="archiveConfirmModal">
        <div class="modal-content small-modal">
            <div class="modal-header">
                <h3>üì¶ Archive Lead</h3>
                <button class="modal-close" id="closeArchiveConfirmModal">√ó</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to <strong>archive</strong> this lead?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelArchive">Cancel</button>
                <button class="btn btn-primary" id="confirmArchive">Archive Lead</button>
            </div>
        </div>
    </div>

    <div class="modal hidden" id="signatureModal">
        <div class="modal-content signature-modal">
            <div class="modal-header">
                <h3>Sign Application</h3>
                <button class="modal-close" id="closeSignatureModal">√ó</button>
            </div>
            <div class="modal-body">
                <canvas id="signatureCanvas" width="400" height="200"></canvas>
                <div class="signature-controls">
                    <button class="btn btn-secondary" id="clearSignature">Clear</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelSignature">Cancel</button>
                <button class="btn btn-primary" id="confirmSignature">Generate</button>
            </div>
        </div>
    </div>

    <div class="modal hidden" id="lendersInlineModal">
        <div class="modal-content modal-xl">
            <div class="modal-header">
                <h3>Lender Qualification & Submission</h3>
                <button class="modal-close" id="closeLendersInlineModal">√ó</button>
            </div>
            <div class="modal-body" id="lendersInlineContent"></div>
        </div>
    </div>

    <div class="notifications" id="notifications"></div>

    <div id="lenderSubmissionModal" class="modal hidden">
        <div class="modal-content lender-submission-modal">

            <div id="submissionOverlay" class="submission-loading-overlay">
                 <div class="submission-loading-card">
                    <div class="submission-spinner"></div>
                    <h3>Sending...</h3>
                    <p id="submissionStatusText" class="status-text">Preparing files...</p>
                    <div class="submission-progress-track">
                        <div id="submissionProgressBar" class="submission-progress-bar"></div>
                    </div>
                </div>
            </div>

            <div class="modal-header">
                <h3>Send to Lenders</h3>
                <button id="closeLenderSubmissionModal" class="modal-close">&times;</button>
            </div>

            <div class="modal-body submission-body">
                <div class="submission-grid">
                    <div class="submission-col">
                        <div class="submission-col-header">
                            <div class="submission-col-title">
                                <div class="toolbar-info-card" id="lenderCountCard">
                                    0 Selected
                                </div>
                            </div>
                            <div class="header-actions">
                                <button class="toolbar-card-btn" id="overrideToggleBtn">
                                    Override Filters
                                </button>
                                <button class="toolbar-card-btn" id="deselectAllLendersBtn">
                                    Deselect All
                                </button>
                            </div>
                        </div>
                        <div class="submission-search-container">
                            <input type="text" id="lenderSearchInput" class="submission-search-input" placeholder="Search lenders..." autocomplete="off">
                        </div>
                        <div id="lenderSelectionList" class="selection-list"></div>
                    </div>

                    <div class="submission-col">
                        <div class="submission-col-header">
                            <div class="submission-col-title">
                                <div class="toolbar-info-card" id="docCountCard">0 SELECTED</div>
                            </div>
                            <div class="header-actions">
                                <button class="toolbar-card-btn" id="selectAllDocsBtn">
                                    Select All
                                </button>
                            </div>
                        </div>
                        <div class="submission-search-container hidden">
                            <input type="text" class="submission-search-input">
                        </div>
                        <div id="submissionDocumentList" class="selection-list documents-list"></div>
                    </div>
                </div>

                <div class="submission-message-area">
                    <label class="field-label">EMAIL MESSAGE (OPTIONAL)</label>
                    <textarea id="submissionMessage" class="submission-textarea" placeholder="Enter a message to include with the submission..."></textarea>
                </div>
            </div>

            <div class="modal-footer">
                <button id="cancelLenderSubmission" class="btn btn-secondary">Cancel</button>
                <button id="confirmLenderSubmission" class="btn btn-primary">
                    <span id="sendSubmissionsText">Send Emails</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Lender Response Modal -->
    <div id="lenderResponseModal" class="modal hidden"></div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content small-modal" style="max-width: 400px;">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> Settings</h3>
                <button class="modal-close" data-action="close-settings">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div class="settings-menu">
                    <a href="/admin.html" class="settings-menu-item" id="userManagementLink">
                        <i class="fas fa-users-cog"></i>
                        <span>User Management</span>
                        <i class="fas fa-chevron-right" style="margin-left: auto; opacity: 0.5;"></i>
                    </a>
                    <div class="settings-menu-item" data-action="open-usage">
                        <i class="fas fa-chart-bar"></i>
                        <span>Usage & Billing</span>
                        <i class="fas fa-chevron-right" style="margin-left: auto; opacity: 0.5;"></i>
                    </div>
                    <div class="settings-menu-item" data-action="logout">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                        <i class="fas fa-chevron-right" style="margin-left: auto; opacity: 0.5;"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Formatter Modal -->
    <div id="formatterModal" class="modal hidden">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-table"></i> Lead Formatter</h3>
                <button class="modal-close" data-action="close-formatter-modal">&times;</button>
            </div>
            <div class="modal-body" style="padding: 24px;">

                <!-- Upload Area -->
                <div class="formatter-upload-area" id="formatterUploadArea">
                    <div class="formatter-upload-icon">üìÅ</div>
                    <div class="formatter-upload-text">Drop your CSV file here</div>
                    <div class="formatter-upload-subtext">or click to browse</div>
                </div>

                <input type="file" id="formatterFileInput" accept=".csv" style="display: none;">

                <!-- Status -->
                <div class="formatter-status" id="formatterStatus"></div>

                <!-- Download Section -->
                <div id="formatterDownloadSection" style="display: none; margin-top: 20px;">
                    <h4 style="margin-bottom: 16px; color: #e6edf3;">üì• Download Your Files</h4>
                    <div class="formatter-downloads">
                        <a href="#" class="formatter-download-btn" id="formatterCrmDownload">
                            <span>üìã CRM Import File</span>
                            <span class="download-desc">Full lead data for your CRM</span>
                        </a>
                        <a href="#" class="formatter-download-btn" id="formatterIphoneDownload">
                            <span>üì± iPhone Mass Texting</span>
                            <span class="download-desc">Name + Phone for SMS campaigns</span>
                        </a>
                        <a href="#" class="formatter-download-btn" id="formatterVonageDownload">
                            <span>‚òéÔ∏è Vonage Format</span>
                            <span class="download-desc">Ready for Vonage import</span>
                        </a>
                    </div>
                </div>

                <!-- Format Info -->
                <div style="margin-top: 20px; padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; font-size: 13px; color: #8b949e;">
                    <strong style="color: #3b82f6;">Auto-detects 3 formats:</strong> Standard, Braintrust, Braintrust TLO
                </div>
            </div>
        </div>
    </div>

    <!-- Usage Modal (Separate, Larger) -->
    <div id="usageModal" class="modal hidden">
        <div class="modal-content" style="max-width: 900px; max-height: 85vh;">
            <div class="modal-header">
                <h3><i class="fas fa-chart-bar"></i> Usage & Billing</h3>
                <button class="modal-close" data-action="close-usage">&times;</button>
            </div>
            <div class="modal-body" style="padding: 20px; overflow-y: auto;">
                <div id="usageContent">
                    <div style="text-align: center; padding: 40px; color: #8b949e;">
                        <div class="loading-spinner"></div>
                        <div style="margin-top: 10px;">Loading usage data...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.5.3/signature_pad.min.js"></script>
    <script src="https://unpkg.com/@twilio/voice-sdk@2.11.0/dist/twilio.min.js"></script>

    <script src="js/debug.js"></script>
    <script type="module" src="js/api.js"></script>
    <script type="module" src="js/formatters.js"></script>

    <script src="js/templates-utilities.js"></script>
    <script src="js/badge-manager.js"></script>
    <script src="js/conversation-animator.js"></script>

    <script src="js/websocket.js"></script>

    <script src="js/lead-formatter.js"></script>
    <script src="js/app-core.js"></script>

    <script src="js/conversation-core.js?v=6"></script>
    <script src="js/messaging.js"></script>
    <script src="js/documents.js"></script>

    <script type="module" src="js/lead-form-controller.js"></script>
    <script type="module" src="js/intelligence-manager.js"></script>

    <script src="js/fcs-module.js"></script>
    <script src="js/lender-network.js"></script>
    <script src="js/lender-rules.js"></script>
    <script src="js/lender-admin.js"></script>
    <script src="js/ai-assistant.js"></script>
    <script src="js/stats.js"></script>
    <script src="js/csv-import-modal.js"></script>
    <script src="js/calling.js"></script>
    <script src="js/power-dialer.js"></script>
    <script src="js/ui-actions.js"></script>

    <script src="js/notes-panel.js"></script>
    <script type="module" src="js/app-bootstrap.js"></script>
    <script src="js/background-verification.js"></script>
    <script src="js/user-menu.js"></script>

</body>
</html>
